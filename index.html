<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="UTF-8"/>
    <title>Shamir's Keystore</title>
    <script>(function(l){var i,s={touchend:function(){}};for(i in s)l.addEventListener(i,s);})(document);</script>
    <style>
      div.main {
        width: 80%; border-style: outset; border-width: 1px; border-radius: 3px; border-color: rgb(224,224,224); margin-left: auto; margin-right: auto;
        padding-left: 1em; padding-right: 1em; padding-top: 0.25em; padding-bottom: 0.25em; background-color: rgb(224,224,224)
      }
      p.headline-0 {
        background-color: rgb(178,24,43); color: rgb(253,219,199); font-family: sans-serif; padding: 3px; border-radius: 3px; font-size: 1.5em; 
        padding-left: 1rem; padding-right: 0.75rem; font-weight: bold;
      }
      p.headline-1 {
        background-color: rgb(77,77,77); color: rgb(253,219,199); font-family: sans-serif; padding: 3px; border-radius: 3px; font-size: 1em; 
        padding-left: 1rem; font-weight: bold;
      }
      p.section {
        color: rgb(26,26,26); font-family: serif; text-align: justify
      }
      div.code {
        border-style: dashed; border-width: 1px; border-color: rgb(103,0,31); background-color: rgb(253,219,199); width: 80%; margin-left: auto; 
        margin-right: auto; overflow-x: auto; white-space: nowrap
      }
      p.code {
        font-family: monospace; font-size: 12px; text-align: left; padding-left: 1rem
      }
      p.formula {
        font-style: italic; font-family: monospace; text-align: center; overflow-x: auto; white-space: nowrap; overflow-y: hidden; font-size: 16px;
      }
      span.formula {
        font-style: italic; font-family: monospace; font-size: 16px;
      }
      div.drop-down-button {
        height: 0rem; padding-right: 1rem; position: relative; float: right;
      }
      img.menu {
        height: 1.5rem; margin-top: 0.8rem;
      }
      div.drop-down-content {
        display: none; background-color: rgb(253,219,199); padding: 1rem; position: absolute; top: 0; left: -5rem; width: 10rem;
        border-radius: 0.25rem; border-color: rgb(77,77,77); border-style: solid; border-width: 1px
      }
      div.drop-down-button:hover div.drop-down-content {
        display: inline-block;
      }
      a.menu {
        color: rgb(77,77,77); font-size: 0.9rem; line-height: 100%; font-family: sans-serif;
      }
      th.cell {
        border-bottom-style: none; border-width: 1px; width: 25%; border-top-style: none; background-color: rgb(244,165,130)
      }
      td.cell {
        border-bottom-style: none; border-width: 1px; width: 25%; border-top-style: none; background-color: rgb(146,197,222)
      }
      div.console {
        border-style: dashed; border-width: 1px; border-color: rgb(103,0,31); background-color: rgb(209,229,240); width: 60%; margin-left: auto; 
        margin-right: auto; overflow-x: auto; white-space: nowrap
      }
      p.console {
        font-family: monospace; font-size: 12px; text-align: left; padding-left: 1rem
      }
      span.code {
        border-style: solid; border-width: 1px; border-color: rgb(103,0,31); background-color: rgb(253,219,199); border-radius: 3px;
        font-family: monospace; font-size: 11px;
      }
    </style>
  </head>
  <body style="background-color: rgb(255,255,255)">
    <div class="main">
      <p style="color: rgb(26,26,26); font-family: serif; font-style: italic; text-align: right; border-bottom-style: solid; border-bottom-width: 1px; 
         border-bottom-color: rgb(26,26,26)">Last updated: 2024-06-25</p>
      <div class="drop-down-button">
        <img class="menu" src="menu-widget.png" alt="menu"/>
        <div class="drop-down-content">
          <a class="menu" href="#2">Abstract</a><br/>
          <a class="menu" href="#3">1. Build</a><br/>
          <a class="menu" href="#4">2. Source Control</a><br/>
          <a class="menu" href="#5">3. The Algorithm</a><br/>
          <a class="menu" href="#6">4. UML Diagrams</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#10">4.1 Component Diagrams</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#11">4.2 Class Diagram</a><br/>
          <a class="menu" href="#7">5. Reports</a><br/>
          <a class="menu" href="#8">6. Download</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#12">6.1 Demo App</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#13">6.2 Maven Coordinates</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#18">6.3 Project Dependencies</a><br/>
          <a class="menu" href="#9">7. User Manual</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#14">7.1 Demo App</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#15">7.2 Keystore Engine</a><br/>
          <a class="menu" href="#16">8. API Docs</a><br/>
          <a class="menu" href="#19">9. JSON Schema</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#20">9.1 Definitions</a><br/>
          <a class="menu" style="font-size: 0.7rem; padding-left: 0.5rem" href="#21">9.2 Exapmple</a><br/>
          <a class="menu" href="#imprint">Imprint</a>
        </div>
      </div>
      <p id="1" class="headline-0">Shamir's Keystore</p>
      <p id="2" class="headline-1">Abstract</p>
      <p class="section">
        This <a href="https://docs.oracle.com/en/java/javase/21/security/java-cryptography-architecture-jca-reference-guide.html#GUID-2BCFDD85-D533-4E6C-8CE9-29990DEB0190">JCA provider</a> presently implements
        <a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">Shamir's Secret Sharing</a> using
        Newton Polynomials. Building on this, a <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/KeyStore.html">KeyStore</a> Engine
        as defined by the <a href="https://docs.oracle.com/en/java/javase/21/security/howtoimplaprovider.html#GUID-C485394F-08C9-4D35-A245-1B82CDDBC031">Java Cryptographic Architecture</a> is provided. Such a keystore instance might
        be unlocked - apart from the master password - by certain subsets of previously computed secret shares. In order to be able to reconstruct the master password a specific number of secret shares 
        equal to (or above) a given threshold must be combined. Shamirs scheme is information-theoretically secure. This means that an attacker does not get any additional information about the original master 
        password with fewer shares as defined by the given threshold. In this way, it is possible to enforce e.g. the four-eye-principle. The provided keystore implementation
        is PKCS12 compliant and internally relies on the implementation provided by the Java platform.
      </p>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="3" class="headline-1">1. Build</p>
      <p class="section">
          Clone the project (or download and unpack the <a href="https://github.com/chr78rm/shamirs-keystore/archive/refs/heads/master.zip">zip</a>):
      </p>
      <div class="code">
        <p class="code">
          $ git clone https://github.com/chr78rm/shamirs-keystore.git<br/>
          $ cd shamirs-keystore
        </p>
      </div>
      <p class="section">
        <a href="https://maven.apache.org/">Maven</a> and a JDK11+ is required for the build of the multi-module project:
      </p>
      <div class="code">
        <p class="code">
          $ mvn clean install
        </p>
      </div>
      <p class="section">
        Above command will compile the sources, run the tests and install the provider into the local Maven repo.
      </p>
      <p class="section">
        Note that the included demo app makes use of the pkix sub-module from the <a href="https://www.bouncycastle.org/download/bouncy-castle-java/">Bouncy Castle</a> crypto library for 
        programmatically generating self-signed X.509 certificates which is something that cannot be easily done with the JDK alone. The library itself
        depends on the <a href="https://www.scala-lang.org/">Scala</a>-Library (since the core module containing the actual algorithm is presently written in Scala) and
        on <a href="https://jakarta.ee/specifications/jsonp/">Jakarta JSON Processing</a>. The latter is merely the specification of an API and hence
        you additionally need an implementation for that at runtime, e.g. <a href="https://github.com/eclipse-ee4j/parsson">Eclipse Parsson</a>, if you want to use
        the JCA provider in your applications. See section <a href="#13">6.2 Maven Coordinates</a> for further details.
      </p>
      <p class="section">
          The project uses <a href="https://junit.org/junit5/">JUnit 5</a> together with <a href="https://assertj.github.io/doc/">AssertJ</a> or rather 
          <a href="https://www.scalatest.org/">ScalaTest</a> for unit testing.
      </p>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="4" class="headline-1">2. Source Control</p>
      <p class="section">
        The source code is hosted in GitHub: <a href="https://github.com/chr78rm/shamirs-keystore">https://github.com/chr78rm/shamirs-keystore</a>.
        <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" style="float: right">
          <img style="height: 1.5rem" src="https://www.gnu.org/graphics/gplv3-with-text-84x42.png" alt="gplv3"/>
        </a>
      </p>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="5" class="headline-1">3. The Algorithm</p>
      <p class="section">
        Consider the polynomial
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = a<sub>k-1</sub>x<sup>k-1</sup> + ... + a<sub>2</sub>x<sup>2</sup> + a<sub>1</sub>x + a<sub>0</sub>
      </p>
      <p class="section">
        of degree <span class="formula">k-1</span> given in the canonical form. Recall that you need <span class="formula">k</span> supporting points to recover a polynomial of
        degree <span class="formula">k-1</span>. Shamir's <span class="formula">(k,n)</span> threshold scheme is building upon this property. A trusted 
        authority randomly selects a polynomial <span class="formula">P<sub>k-1</sub></span> and computes <span class="formula">n</span> supporting points whereby 
        <span class="formula">n >= k</span> applies. 
        The to be shared secret <span class="formula">s</span> is encoded as <span class="formula">a<sub>0</sub></span>. The <span class="formula">n</span> supporting points 
        are distributed among the participants. To compute the original secret <span class="formula">s</span> the participants must combine <span class="formula">k</span> of 
        the supporting points. In order to avoid that an adversary gains any knowledge about the secret by merging less than <span class="formula">k</span> supporting points 
        all computations will by implemented by using finite field arithmetic. That means we choose a finite field <span class="formula">&#120125;<sub>p</sub></span> whereby 
        <span class="formula">p</span> is prime and <span class="formula">a<sub>0</sub> &lt; p</span> applies.
      </p> 
      <p class="section">
        The simplest procedure for reconstructing a polynomial <span class="formula">P</span> of degree <span class="formula">k-1</span> with given <span class="formula">k</span> 
        supporting points <span class="formula">(x<sub>0</sub>,y<sub>0</sub>),...,(x<sub>k-1</sub>,y<sub>k-1</sub>)</span> is by devising a system of 
        <span class="formula">k</span> linear equations. A parabola, for instance, is defined by three supporting points 
        <span class="formula">(x<sub>0</sub>,y<sub>0</sub>),(x<sub>1</sub>,y<sub>1</sub>),(x<sub>2</sub>,y<sub>2</sub>)</span>. The coefficients
        <span class="formula">a<sub>0</sub>,a<sub>1</sub>,a<sub>2</sub></span> can be computed by solving the system of linear equations below:
      </p>
      <p class="formula">
        y<sub>0</sub> = a<sub>2</sub>x<sub>0</sub><sup>2</sup> + a<sub>1</sub>x<sub>0</sub> + a<sub>0</sub><br/>
        y<sub>1</sub> = a<sub>2</sub>x<sub>1</sub><sup>2</sup> + a<sub>1</sub>x<sub>1</sub> + a<sub>0</sub><br/>
        y<sub>2</sub> = a<sub>2</sub>x<sub>2</sub><sup>2</sup> + a<sub>1</sub>x<sub>2</sub> + a<sub>0</sub><br/>
      </p>
      <p class="section">
        There are, however, more efficient algorithms. This distribution uses the Newton interpolation method to recover the secret <span class="formula">s</span>.
        A Newton polynomial of degree <span class="formula">k-1</span> is given by
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = <span style="font-size: 18px; font-style: normal">&#x1D768; </span>
        <sub style="font-size: 10px; position: relative; top: 0em; left: -0.75em">i=0</sub>
        <sup style="position: relative; left: -3.1em; top: -0.25em; font-size: 10px">k-1</sup>
        <span style="position: relative; left: -2.25em;">c<sub>i</sub>N<sub>i</sub>(x)</span>
      </p>
      <p class="section">
        with Newton coefficients <span class="formula">c<sub>0</sub>,c<sub>1</sub>,...,c<sub>k-1</sub></span> and the Newton basis polynomials
        <span class="formula">N<sub>0</sub> = 1</span> and 
        <span class="formula">
          N<sub>i</sub> = <span style="font-size: 18px; font-style: normal">&#x1D79F; </span>
          <sub style="font-size: 10px; position: relative; top: 0em; left: -1em">j=0</sub>
          <sup style="position: relative; left: -3.1em; top: -0.25em; font-size: 10px">i-1</sup>
          <span style="position: relative; left: -2.5em;">(x - x<sub>j</sub>).</span>
        </span>
      </p>
      <p class="section">
        This gives
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = c<sub>0</sub> + c<sub>1</sub>(x - x<sub>0</sub>) + c<sub>2</sub>(x - x<sub>0</sub>)(x - x<sub>1</sub>) + &#x22EF; + c<sub>k-1</sub>(x - x<sub>0</sub>) &#x22EF; (x - x<sub>k-2</sub>)
      </p>
      <p class="section">
        By applying <span class="formula">x &#x2190; x<sub>0</sub>,x &#x2190; x<sub>1</sub>,x &#x2190; x<sub>2</sub>,...</span> it follows
      </p>
      <p class="formula" style="text-align: left; padding-left: 10em">
        P(x<sub>0</sub>) = c<sub>0</sub><br/>
        P(x<sub>1</sub>) = c<sub>0</sub> + c<sub>1</sub>(x<sub>1</sub> - x<sub>0</sub>)<br/>
        P(x<sub>2</sub>) = c<sub>0</sub> + c<sub>1</sub>(x<sub>2</sub> - x<sub>0</sub>) + c<sub>2</sub>(x<sub>2</sub> - x<sub>0</sub>)(x<sub>2</sub> - x<sub>1</sub>)<br/>
        P(x<sub>3</sub>) = c<sub>0</sub> + c<sub>1</sub>(x<sub>3</sub> - x<sub>0</sub>) + c<sub>2</sub>(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>) + c<sub>3</sub>(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>)(x<sub>3</sub> - x<sub>2</sub>)<br/>
        <span style="font-style: normal; position: relative; left: 2em">&#x22EE;</span><span style="font-style: normal; position: relative; left: 5em">&#x22EE;</span>
      </p>
      <p class="section">
        Since we are interested in recovering the Newton polynomial by using the supporting points we rearrange the equations above:
      </p>
      <p class="formula" style="text-align: left; padding-left: 10em">
        c<sub>0</sub> = y<sub>0</sub><br/>
        c<sub>1</sub> = (y<sub>1</sub> - c<sub>0</sub>)/(x<sub>1</sub> - x<sub>0</sub>)<br/>
        c<sub>2</sub> = (y<sub>2</sub> - c<sub>0</sub> - c<sub>1</sub>(x<sub>2</sub> - x<sub>0</sub>))/(x<sub>2</sub> - x<sub>0</sub>)(x<sub>2</sub> - x<sub>1</sub>)<br/>
        c<sub>3</sub> = (y<sub>3</sub> - c<sub>0</sub> - c<sub>1</sub>(x<sub>3</sub> - x<sub>0</sub>) - c<sub>2</sub>(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>))/(x<sub>3</sub> - x<sub>0</sub>)(x<sub>3</sub> - x<sub>1</sub>)(x<sub>3</sub> - x<sub>2</sub>)<br/>
        <span style="font-style: normal; position: relative; left: 1em">&#x22EE;</span><span style="font-style: normal; position: relative; left: 3em">&#x22EE;</span>
      </p>
      <p class="section">
        Now we can clearly see a recurring pattern. Thus, the Newton coefficients can be computed by a recursive procedure and by memoizing the already calculated 
        coefficients (dynamic programming), 
        see <a href="https://github.com/chr78rm/shamirs-keystore/blob/master/shamirs-secret-sharing/src/main/scala/de/christofreichardt/scala/shamir/NewtonInterpolation.scala">NewtonInterpolation.scala</a>
        for details.
      </p>
      <p class="section">
        We need to evaluate the interpolated polynom at least at one point, namely at <span class="formula">P(0) = a<sub>0</sub></span> to recover the original secret. An efficient
        way of doing this is by applying Horner's scheme. The Newton polynomial <span class="formula">P</span> of degree <span class="formula">k-1</span> can be rewritten as
      </p>
      <p class="formula">
        P<sub>k-1</sub>(x) = c<sub>0</sub> + (x - x<sub>0</sub>)[c<sub>1</sub> + (x - x<sub>1</sub>)[c<sub>2</sub> + &#x22EF; + c<sub>k-1</sub>(x - x<sub>k-2</sub>)] &#x22EF; ]
      </p>
      <p class="section">
        so that <span class="formula">P(x)</span> can be calculated recursively:
      </p>
      <p class="formula" style="text-align: left; padding-left: 10em">
        b<sub>0</sub> = c<sub>0</sub> + (x - x<sub>0</sub>)b<sub>1</sub><br/>
        b<sub>1</sub> = c<sub>1</sub> + (x - x<sub>1</sub>)b<sub>2</sub><br/>
        b<sub>2</sub> = c<sub>2</sub> + (x - x<sub>2</sub>)b<sub>3</sub><br/>
        <span style="font-style: normal; position: relative; left: 1em">&#x22EE;</span><span style="font-style: normal; position: relative; left: 3em">&#x22EE;</span><br/>
        b<sub>k-1</sub> = c<sub>k-1</sub>
      </p>
      <p class="section">
        where <span class="formula">P(x) = b<sub>0</sub></span> .
      </p>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="6" class="headline-1">4. UML Diagrams</p>
      <p id="10" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">4.1 Component Diagrams</p>
      <div style="text-align: center">
        <img style="width: 80%; height: auto" src="uml/component-diagram-1.png" alt="component-diagram-1"/>
        <img style="width: 80%; height: auto; margin-top: 1em" src="uml/component-diagram-2.png" alt="component-diagram-2"/>
      </div>
      <p id="11" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">4.2 Class Diagram</p>
      <div style="text-align: center">
        <img style="width: 80%" src="uml/class-diagram.png" alt="class-diagram"/>
      </div>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="7" class="headline-1">5. Reports</p>
      <p class="section">
        The two sub modules shamirs-keystore - containing the actual JCA provider - and shamirs-demo are both using <a href="https://junit.org/junit5/">JUnit5</a> for their 
        unit testing. The <a href="https://maven.apache.org/surefire/maven-surefire-plugin/">Maven Surefire Plugin</a> up to version 3.2.5 is confused about JUnit5's
        <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-nested">nested tests</a> and hence
        doesn't accurately produce the numbers for the reports. The two linked reports below have been generated by a custom 
        JUnit5 <a href="https://junit.org/junit5/docs/current/user-guide/#launcher-api-listeners-custom">TestExecutionListener</a> during the last build.
      </p>
      <table style="font-family: serif; width: 40%; margin-left: auto; margin-right: auto">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">JUnit5 reports</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 50%">Artifact</th>
            <th class="cell" style="width: 50%">Report</th>
          </tr>
          <tr style="">
            <td style="border-bottom-style: none; border-width: 1px; width: 50%; border-top-style: none; background-color: rgb(146,197,222)">shamirs-keystore</td>
            <td style="border-bottom-style: none; border-width: 1px; width: 50%; border-top-style: none; background-color: rgb(146,197,222)"><a href="./reports/shamirs-keystore-summary.txt">summary.txt</a></td>
          </tr>
          <tr>
            <td style="border-bottom-style: none; border-bottom-width: 1px; width: 50%; background-color: rgb(146,197,222)">shamirs-demo</td>
            <td style="border-bottom-style: none; border-bottom-width: 1px; width: 50%; background-color: rgb(146,197,222)"><a href="./reports/shamirs-demo-summary.txt">summary.txt</a></td>
          </tr>
        </tbody>
      </table>
      <p class="section">
        The sub module shamirs-secret-sharing - containing the actual algorithm - is written in <a href="https://www.scala-lang.org/">Scala</a> and uses 
        <a href="http://www.scalatest.org/">ScalaTest</a> for its unit testing. Again a custom 
        <a href="https://www.scalatest.org/scaladoc/3.2.18/org/scalatest/Reporter.html">Reporter</a>
        is used to collect the events occurring throughout the execution of the tests. The linked report below has been generated during the last build.
      </p>
      <table style="font-family: serif; width: 40%; margin-left: auto; margin-right: auto">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">ScalaTest reports</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 50%">Artifact</th>
            <th class="cell" style="width: 50%">Report</th>
          </tr>
          <tr style="">
            <td style="border-bottom-style: none; border-width: 1px; width: 50%; border-top-style: none; background-color: rgb(146,197,222)">shamirs-secret-sharing</td>
            <td style="border-bottom-style: none; border-width: 1px; width: 50%; border-top-style: none; background-color: rgb(146,197,222)"><a href="./reports/shamirs-secret-sharing-summary.txt">summary.txt</a></td>
          </tr>
        </tbody>
      </table>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="8" class="headline-1">6. Download</p>
      <p id="12" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">6.1 Demo App</p>
      <p class="section">
        The demo app has been packaged by the <a href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven Shade Plugin</a>. The subsequently provided downloads contain the demo app and 
        both the core module with the algorithm and the actual JCA provider.
      </p>
      <table style="font-family: serif; width: 85%; margin-left: auto; margin-right: auto">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">shamirs-demo</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 15%">Artifact</th>
            <th class="cell">Archive</th>
            <th class="cell">Build Time</th>
            <th class="cell">sha512 checksum</th>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">shamirs-demo-1.0.0-beta</td>
            <td class="cell">
              <a href="https://www.dropbox.com/s/rhs76o31qppix9m/shamirs-demo-1.0.0-beta.zip?dl=1">shamirs-demo-1.0.0-beta.zip</a>
            </td>
            <td class="cell">2020-05-20 13:50:27.364 +0200</td>
            <td class="cell">
              <a href="./shamirs-demo-1.0.0-beta.zip.sha512.txt">shamirs-demo-1.0.0-beta.zip.sha512</a>
            </td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">shamirs-demo-1.0.0-rc1</td>
            <td class="cell">
              <a href="https://www.dropbox.com/s/8jy5ufo4loiyv84/shamirs-demo-1.0.0-rc1.zip?dl=1">shamirs-demo-1.0.0-rc1.zip</a>
            </td>
            <td class="cell">2020-12-18 15:43:09.754 +0100</td>
            <td class="cell">
              <a href="./shamirs-demo-1.0.0-rc1.zip.sha512.txt">shamirs-demo-1.0.0-rc1.zip.sha512</a>
            </td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">shamirs-demo-1.0.0</td>
            <td class="cell">
              <a href="https://www.dropbox.com/s/91ihwzbv43sfpmm/shamirs-demo-1.0.0.zip?dl=1">shamirs-demo-1.0.0.zip</a>
            </td>
            <td class="cell">2021-01-06 14:57:47.925 +0100</td>
            <td class="cell">
              <a href="./shamirs-demo-1.0.0.zip.sha512.txt">shamirs-demo-1.0.0.zip.sha512</a>
            </td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">shamirs-demo-1.1.0</td>
            <td class="cell">
              <a href="https://www.dropbox.com/s/bjoubkv7sn8wqw4/shamirs-demo-1.1.0.zip?dl=1">shamirs-demo-1.1.0.zip</a>
            </td>
            <td class="cell">2021-05-26 17:20:08.866 +0200</td>
            <td class="cell">
              <a href="./shamirs-demo-1.1.0.zip.sha512.txt">shamirs-demo-1.1.0.zip.sha512</a>
            </td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">shamirs-demo-1.2.0</td>
            <td class="cell">
              <a href="https://www.dropbox.com/s/z88lq9i6xuooimh/shamirs-demo-1.2.0.zip?dl=1">shamirs-demo-1.2.0.zip</a>
            </td>
            <td class="cell">2022-04-22 14:57:24.886 +0200</td>
            <td class="cell">
              <a href="./shamirs-demo-1.2.0.zip.sha512.txt">shamirs-demo-1.2.0.zip.sha512</a>
            </td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">shamirs-demo-1.3.0</td>
            <td class="cell">
              <a href="https://www.dropbox.com/scl/fi/f1whcxg2r4zj2xa9i4w61/shamirs-demo-1.3.0.zip?rlkey=avuxwmfygjk31mdda4zzkyi8k&dl=1">shamirs-demo-1.3.0.zip</a>
            </td>
            <td class="cell">2024-03-12 13:41:47.720 +0100</td>
            <td class="cell">
              <a href="./shamirs-demo-1.3.0.zip.sha512.txt">shamirs-demo-1.3.0.zip.sha512</a>
            </td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">shamirs-demo-1.3.1</td>
            <td class="cell">
              <a href="https://www.dropbox.com/scl/fi/v6oo56s86ek6vs8ndvqsq/shamirs-demo-1.3.1.zip?rlkey=d85ky0lav9rm1tj44z7mgjq74&dl=1">shamirs-demo-1.3.1.zip</a>
            </td>
            <td class="cell">2024-06-19 16:36:40.012 +0200</td>
            <td class="cell">
              <a href="shamirs-demo-1.3.1.zip.sha512.txt">shamirs-demo-1.3.1.zip.sha512</a>
            </td>
          </tr>
        </tbody>
      </table>
      <p class="section">
        Note that the demo app includes binaries from external open source projects, namely the <a href="https://www.scala-lang.org/">Scala</a>-Library, 
        the Jakarta JSON-Processing implementation <a href="https://github.com/eclipse-ee4j/parsson">Eclipse Parsson</a> and
        the pkix sub-module from <a href="https://www.bouncycastle.org/download/bouncy-castle-java/">Bouncy Castle</a>. Section <a href="#14">7.1 Demo App</a> explains how to use the demo app.
      </p>
      <p id="13" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">6.2 Maven Coordinates</p>
      <p class="section">
        The KeyStore engine together with the relevant artifacts had been deployed to Maven Central and can be used within your applications by referencing the subsequent Maven coordinates:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">&lt;dependency&gt;
    &lt;groupId&gt;de.christofreichardt&lt;/groupId&gt;
    &lt;artifactId&gt;shamirs-keystore&lt;/artifactId&gt;
    &lt;version&gt;1.3.1&lt;/version&gt;
&lt;/dependency&gt;</p>
      </div>
      <p class="section">
        You will additionally need an implementation for the Jakarta JSON Processing API at runtime, e.g.
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">&lt;dependency&gt;
    &lt;groupId&gt;org.eclipse.parsson&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.json&lt;/artifactId&gt;
    &lt;version&gt;1.1.5&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</p>
      </div>
      <p class="section">
        Depending on your deployment the latter runtime dependency might not be necessary, e.g. if you are using a Jakarta EE application server. Starting with version 1.3.0 the library uses the
        new <span class="code">jakarta.json</span> namespace instead of the legacy <span class="code">javax.json</span> and should therefore
        be compatible with Jakarta EE 9 upwards. An alternative to Eclipse Parsson
        is <a href="https://leadpony.github.io/joy/">Joy</a> but Eclipse Parsson seems to be more actively maintained and it is the reference implementation.
      </p>
      <p class="section">
        Section <a href="#15">7.2 Keystore Engine</a> explains how to use the provider within your applications.
      </p>
      <p id="18" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">6.3 Project Dependencies</p>
      <p class="section">
        These are the third-party dependencies of the latest version:
      </p>
      <table style="font-family: serif; width: 85%; margin-left: auto; margin-right: auto; margin-top: 1rem">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">Dependencies</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 15%">GroupId</th>
            <th class="cell" style="width: 15%">ArtifactId</th>
            <th class="cell" style="width: 15%">Version</th>
            <th class="cell" style="width: 15%">Scope</th>
            <th class="cell" style="width: 40%">License</th>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">de.christofreichardt</td>
            <td class="cell" style="width: 15%">tracelogger</td>
            <td class="cell" style="width: 15%">1.10.0</td>
            <td class="cell" style="width: 15%">compile</td>
            <td class="cell" style="width: 40%">Apache License, Version 2.0</td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">org.scala-lang</td>
            <td class="cell" style="width: 15%">scala3-library_3</td>
            <td class="cell" style="width: 15%">3.3.3</td>
            <td class="cell" style="width: 15%">compile</td>
            <td class="cell" style="width: 40%">Apache License, Version 2.0</td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">org.scala-lang</td>
            <td class="cell" style="width: 15%">scala-library</td>
            <td class="cell" style="width: 15%">2.13.12</td>
            <td class="cell" style="width: 15%">compile</td>
            <td class="cell" style="width: 40%">Apache License, Version 2.0</td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">jakarta.json</td>
            <td class="cell" style="width: 15%">jakarta.json-api</td>
            <td class="cell" style="width: 15%">2.1.3</td>
            <td class="cell" style="width: 15%">compile</td>
            <td class="cell" style="width: 40%">GNU General Public License Version 2 with Classpath Exception,<br/>Eclipse Public License 2.0</td>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">org.eclipse.parsson</td>
            <td class="cell" style="width: 15%">jakarta.json</td>
            <td class="cell" style="width: 15%">1.1.5</td>
            <td class="cell" style="width: 15%">provided</td>
            <td class="cell" style="width: 40%">GNU General Public License Version 2 with Classpath Exception,<br/>Eclipse Public License 2.0</td>
          </tr>
        </tbody>
      </table>
      <p class="section">
        The demo app has an additional dependency on Bouncy Castle's pkix sub-module:
      </p>
      <table style="font-family: serif; width: 85%; margin-left: auto; margin-right: auto; margin-top: 1rem">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">Dependencies</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 15%">GroupId</th>
            <th class="cell" style="width: 15%">ArtifactId</th>
            <th class="cell" style="width: 15%">Version</th>
            <th class="cell" style="width: 15%">Scope</th>
            <th class="cell" style="width: 40%">License</th>
          </tr>
          <tr style="">
            <td class="cell" style="width: 15%">org.bouncycastle</td>
            <td class="cell" style="width: 15%">bcpkix-jdk18on</td>
            <td class="cell" style="width: 15%">1.78.1</td>
            <td class="cell" style="width: 15%">compile</td>
            <td class="cell" style="width: 40%">MIT License</td>
          </tr>
        </tbody>
      </table>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="9" class="headline-1">7. User Manual</p>
      <p id="14" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">7.1 Demo App</p>
      <p class="section">
        <a href="#8">Download</a> the demo app and unzip the archive into a directory of your choice. A JDK11+ is needed for the execution of the app. I am using the 
        <a href="https://git-scm.com/download/win">Git Bash</a> for this manual but the default command line interpreter of Windows 
        (<a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/cmd">cmd</a>) works as well. Of course you can use the 
        <a href="https://www.gnu.org/software/bash/">GNU Bash</a> on Linux systems too. I have tested the distribution with the Git Bash on Windows 10, with Windows Cmd on Windows 10 and with
        the GNU Bash on Ubuntu 20.04.6 LTS (Focal Fossa) by randomly using a JDK-11, JDK-17, JDK-21 or JDK-22. 
      </p>
      <p class="section">
        After unzipping the distribution exhibits the following structure:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">shamirs-demo/
├── log
├── src
│   └── main
│       ├── java
│       │   └── de
│       │       └── christofreichardt
│       │           └── jca
│       │               └── shamirsdemo
│       │                   ├── AbstractMenu.java
│       │                   ├── App.java
│       │                   ├── AppCallback.java
│       │                   ├── KeyStoreMenu.java
│       │                   ├── MainMenu.java
│       │                   └── Menu.java
│       └── resources
│           └── de
│               └── christofreichardt
│                   └── jca
│                       └── trace-config.xml
├── target
│   └── shamirs-demo-1.3.1.jar
├── workspace
│   └── my-workspace-0
│       ├── my-keys.p12
│       ├── test-0.json
│       ├── test-1.json
│       ├── test-2.json
│       ├── test-3.json
│       ├── test-4.json
│       ├── test-5.json
│       ├── test-6.json
│       └── test.json
├── LICENCE.txt
├── NOTICE.txt
├── run-shamirs-demo.bat
├── run-shamirs-demo.sh
└── winpty-shamirs-demo.sh</p>
      </div>
      <table style="margin-top: 0rem">
        <tbody>
          <tr>
            <td><img style="width: 2rem; float: left; margin-right: 1em; display: grid" src="./101.png" alt="CAUTION"/></td>
            <td>
              <p class="section">
                Starting with JDK-22, Java uses an internal JLine instance as the default Console implementation to improve the user experience of programs using the Console API, see
                <a href="https://www.oracle.com/java/technologies/javase/22-relnote-issues.html#JDK-8308591">JLine As The Default Console Provider</a>. Indeed, the
                <a href="https://github.com/rprichard/winpty">winpty</a> wrapper isn't needed anymore to run the demo when using the Git Bash in conjunction with JDK-22. Unfortunately, this change 
                presently seems to break the bulk read operations when using the <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/Reader.html">Reader</a> associated with 
                the Console, see <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/Console.html#reader()">Console#reader()</a>. You would have to restore the older behaviour
                by additionally passing <span class="code" style="white-space: nowrap">-Djdk.console=java.base</span> when launching older demo versions (prior to 1.3.1) on JDK-22.
              </p>
            </td>
          </tr>
        </tbody>
      </table>
      <p class="section" style="margin-top: -0.5rem">
        Refer to the table below for the selection of a suitable launch script depending on Operating System and JDK version:
      </p>
      <table style="font-family: serif; width: 85%; margin-left: auto; margin-right: auto; margin-top: 1rem; margin-top: 0rem">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">Launch scripts</caption>
        <tbody>
          <tr>
            <th class="cell"></th>
            <th class="cell">Git Bash on Windows</th>
            <th class="cell">Windows Cmd</th>
            <th class="cell">Linux Bash</th>
          </tr>
          <tr style="text-align: center">
            <td style="background-color: rgb(244,165,130); font-weight: bold">JDK-11 until JDK-21</td>
            <td class="cell">winpty-shamirs-demo.sh</td>
            <td class="cell" rowspan="2">run-shamirs-demo.bat</td>
            <td class="cell" rowspan="2">run-shamirs-demo.sh</td>
          </tr>
          <tr style="text-align: center">
            <td style="background-color: rgb(244,165,130); font-weight: bold">JDK-22</td>
            <td class="cell">run-shamirs-demo.sh</td>
          </tr>
        </tbody>
      </table>
      <p class="section">
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">$ cd shamirs-demo/
$ ls
LICENCE.txt  log/  NOTICE.txt  run-shamirs-demo.bat  run-shamirs-demo.sh*  src/  target/  winpty-shamirs-demo.sh*  workspace/
$ java -version
openjdk version "22.0.1" 2024-04-16
OpenJDK Runtime Environment (build 22.0.1+8-16)
OpenJDK 64-Bit Server VM (build 22.0.1+8-16, mixed mode, sharing)
$ ./run-shamirs-demo.sh
...
+---------------+
| Shamir's Demo |
+---------------+

Current time: 2024-06-18T15:54:09.3878296
   Workspace: 2024-06-18

2024-06-18-> Main menu

       (s)plit password       (m)erge password       (o)pen workspace
      (c)reate keystore        (lo)ad keystore       (li)st workspace
                 (e)xit

2024-06-18-></p>
      </div>
      <p class="section">
        The string <span class="code">2024-06-18</span> left from the arrow denotes the current date and workspace. You automatically get a new one on every day you are using
        the app. The provided commands are invoked by their given shortcuts. Since this newly created workspace is empty we begin with splitting
        a password:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> s
2024-06-18-> split password
2024-06-18-> Password ([A-Za-z0-9-]{8,45}) [FU97W8aNeirrDFE6NYV3VHByH]:
2024-06-18-> Number of shares ([0-9]+): 12
2024-06-18-> Threshold ([0-9]+): 4
2024-06-18-> Name of partition ([A-Za-z]{1,10}): demo
2024-06-18-> Number of slices ([0-9]+): 7
2024-06-18-> Size[i=0, sum=0] ([0-9]+): 4
2024-06-18-> Size[i=1, sum=4] ([0-9]+): 2
2024-06-18-> Size[i=2, sum=6] ([0-9]+): 2
2024-06-18-> Size[i=3, sum=8] ([0-9]+): 1
2024-06-18-> Size[i=4, sum=9] ([0-9]+): 1
2024-06-18-> Size[i=5, sum=10] ([0-9]+): 1
2024-06-18-> Size[i=6, sum=11] ([0-9]+): 1
2024-06-18-> Certification method (All|Slices|None) [None]: All
-------------------------------------------------------------
certificationResult = (298 falsified, 495 verified)</p>
      </div>
      <p class="section">
        The app will make a password proposal (seen within the square brackets). Every user provided input will be matched against the regular expressions 
        given in the round brackets. In our example we instructed to generate 12 shares whereas 4 of them are needed to recover the original password. The shares
        are grouped within a partition named <span class="code">demo</span>. The 12 shares were divided into 7 slices. The first slice had been given 4
        shares. The next two slices had both received 2 shares and the remaining slices had been in each case given 1 share. The found solution can be optionally certified.
        The preset is no certification at all. A certification by <span class="code">Slices</span> means that all slice combinations with a sharepoint count less than the threshold will be falsified 
        and vice versa all slice combinations with a sharepoint count equal to or above the threshold will be verified. The certification method <span class="code">All</span> means that regardless 
        of the chosen slices all combinations of shares below the threshold will be falsified and all combination of shares that equals the threshold will be verified. These are potentially very 
        expensive operations depending on the number of combinations that have to be considered. You can consult <a href="https://www.wolframalpha.com/">WolframAlpha</a> for the computation of the binomial 
        coefficients, e.g. <a href="https://www.wolframalpha.com/input?i=12+choose+4">12 choose 4</a> gives 495 as expected. A negative outcome would raise an 
        <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/AssertionError.html">AssertionError</a>. 
      </p>
      <p class="section">
        (By pure chance a sharepoint combination below the threshold might result in the same y-intercept as the actual solution, that should be almost impossible if you are using long enough 
        passwords which result in correspondingly big-sized finite fields).
      </p>
      <p class="section">
          Now, open another console and review the content of the your workspace directory (workspace/yyyy-MM-dd):
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">$ ls workspace/2024-06-18/
demo.json  demo-0.json  demo-1.json  demo-2.json  demo-3.json  demo-4.json  demo-5.json  demo-6.json</p>
      </div>
      <p class="section">
        The file <span class="code">demo.json</span> contains all of the generated shares, <span class="code">demo-0.json</span> four of them, 
        <span class="code">demo-1.json</span> two and so on. 
        The idea is that we have seven participants in our example. Each of them will be given one slice. This means the participant owning the slice 
        <span class="code">demo-0.json</span> is able to recover the password by herself whereas the owner of <span class="code">demo-1.json</span> must team up with 
        the owner of <span class="code">demo-2.json</span> or with two of the owners of the remaining slices and so on. Now switch back to the demo app and invoke
        <span class="code">(li)st workspace</span>:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> li
2024-06-18-> list workspace
2024-06-18-> Partitions: [demo]
2024-06-18-> Slices(demo): [demo-0.json, demo-1.json, demo-2.json, demo-3.json, demo-4.json, demo-5.json, demo-6.json]
2024-06-18-> Keystores: []</p>
      </div>
      <p class="section">
        We have already seen that. Now lets recover the original password by combining the slices <span class="code">demo-1.json</span>,
        <span class="code">demo-3.json</span> and <span class="code">demo-6.json</span>:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> m
2024-06-18-> merge password
2024-06-18-> Slices (([A-Za-z]{1,10}-[0-9]+\.json(,( )*)?)+([A-Za-z]{1,10}-[0-9]+\.json)?): demo-1.json, demo-3.json, demo-6.json
2024-06-18-> password = FU97W8aNeirrDFE6NYV3VHByH</p>
      </div>
      <p class="section">
        As expected. Merging works, inter alia, by providing a list of <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/nio/file/Path.html">Path</a>s 
        to the different slices and then applying Newtons Interpolation. That means the slices
        need not necessarily be located together in one directory as in our demo. In fact they could be distributed over the whole filesystem and could be
        located even on remote devices. Think of plugged-in USB memory sticks or network filesystems. Future versions might interpret the Paths as 
        <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/URI.html">URI</a>s and could fetch the slices via the internet if required. <br/>
      </p>
      <p class="section">
        Now, let's create a keystore:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> Main menu

       (s)plit password       (m)erge password       (o)pen workspace
      (c)reate keystore        (lo)ad keystore       (li)st workspace
                 (e)xit

2024-06-18-> c
2024-06-18-> create keystore
2024-06-18-> Keystore name ([A-Za-z-]{1,20}): donalds-keys
2024-06-18-> Slices (([A-Za-z]{1,10}-[0-9]+\.json(,( )*)?)+([A-Za-z]{1,10}-[0-9]+\.json)?): demo-3.json, demo-4.json, demo-5.json, demo-6.json

+---------------+
| Shamir's Demo |
+---------------+

Current time: 2024-06-18T16:18:42.3677483
   Workspace: 2024-06-18

2024-06-18-> KeyStore menu [donalds-keys]

         (l)ist entries          (p)rivate key           (s)ecret key
          (c)ertificate            (m)ain menu

2024-06-18-></p>
      </div>
      <p class="section">
        We used four of the slices containing a single share to produce the credentials for the keystore. The demo app switched to a submenu regarding
        keystore functionality. At present the keystore is empty. A Java PKCS12 keystore can contain three different types of entries:
        <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/KeyStore.PrivateKeyEntry.html">Private Key</a>, 
        <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/KeyStore.SecretKeyEntry.html">Secret Key</a> and 
        <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/KeyStore.TrustedCertificateEntry.html">Certificate</a> entries.
        Private and Secret Keys need protection whereas certificates need not since latter are public. Hence we will create a Private Key. A Private Key
        is always accompanied with a certifcate that attests the associated Public Key. From the start these certificates are self-signed but could
        be the result from a PKCS10 certificate request too.
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> p
2024-06-18-> private key
2024-06-18-> Keygenerator algorithm (DSA|RSA|EC): EC
2024-06-18-> Validity ([0-9]+): 100
2024-06-18-> Common Name ([A-Za-z- ]{5,30}): Donald Duck
2024-06-18-> Locality ([A-Za-z- ]{5,30}): Entenhausen
2024-06-18-> State ([A-Za-z- ]{5,30}): Bayern
2024-06-18-> Country ([A-Za-z- ]{5,30}): Deutschland
2024-06-18-> Alias ([a-z0-9-]{5,25}): donalds-private-ec-key</p>
      </div>
      <p class="section">
        We specified Elliptic Curve (EC) as <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/KeyPairGenerator.html">KeyPairGenerator</a> 
        algorithm and a validity of 100 days for the accompanying self-signed certificate. The remaining parameter constitute the so called
        <a href="https://datatracker.ietf.org/doc/html/rfc2253">Distinguished Name</a>.
      </p>
      <p class="section">
        Now, list the entries so far:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> l
2024-06-18-> list entries
2024-06-18-> donalds-private-ec-key: friendlyName=donalds-private-ec-key, localId=54:69:6d:65:20:31:37:31:38:37:32:30:34:37:36:36:39:38, algorithm=EC, keytype=Private Key</p>
      </div>
      <p class="section">
        Go back to main menu:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> m
2024-06-18-> main menu

+---------------+
| Shamir's Demo |
+---------------+

Current time: 2024-06-18T16:25:05.3273361
   Workspace: 2024-06-18

2024-06-18-> Main menu

       (s)plit password       (m)erge password       (o)pen workspace
      (c)reate keystore        (lo)ad keystore       (li)st workspace
                 (e)xit

2024-06-18-></p>
      </div>
      <p class="section">
        Now, list the workspace again:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> li
2024-06-18-> list workspace
2024-06-18-> Partitions: [demo]
2024-06-18-> Slices(demo): [demo-0.json, demo-1.json, demo-2.json, demo-3.json, demo-4.json, demo-5.json, demo-6.json]
2024-06-18-> Keystores: [donalds-keys]</p>
      </div>
      <p class="section">
        Again, merge some of the slices to recover the password of the keystore:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> m
2024-06-18-> merge password
2024-06-18-> Slices (([A-Za-z]{1,10}-[0-9]+\.json(,( )*)?)+([A-Za-z]{1,10}-[0-9]+\.json)?): demo-1.json, demo-2.json
2024-06-18-> password = FU97W8aNeirrDFE6NYV3VHByH</p>
      </div>
      <p class="section">
        Switch to a separate console since we want to investigate the keystore with 
        <a href="https://docs.oracle.com/en/java/javase/21/docs/specs/man/keytool.html">keytool</a>. Note that your own workspace is probably
        different.
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">$ cd workspace/2024-06-18  # workspace/yyyy-MM-dd
$ ls
demo.json  demo-0.json  demo-1.json  demo-2.json  demo-3.json  demo-4.json  demo-5.json  demo-6.json  donalds-keys.p12
$ keytool -J-Duser.language=en -list -keystore donalds-keys.p12 -storepass FU97W8aNeirrDFE6NYV3VHByH -storetype pkcs12 -v
Keystore type: PKCS12
Keystore provider: SUN

Your keystore contains 1 entry

Alias name: donalds-private-ec-key
Creation date: 18 Jun 2024
Entry type: PrivateKeyEntry
Certificate chain length: 1
Certificate[1]:
Owner: C=Deutschland, ST=Bayern, L=Entenhausen, CN=Donald Duck
Issuer: C=Deutschland, ST=Bayern, L=Entenhausen, CN=Donald Duck
Serial number: 1902bb93557
Valid from: Tue Jun 18 16:21:16 CEST 2024 until: Thu Sep 26 16:21:16 CEST 2024
Certificate fingerprints:
         SHA1: AD:CB:EC:03:0A:81:88:6C:10:BA:1F:DF:6A:E9:3F:A7:61:20:35:53
         SHA256: 86:77:4C:87:A0:BC:9A:CF:EB:EE:7E:14:B9:36:34:0B:57:2F:0B:A5:CA:5F:6E:32:59:4C:CA:91:54:37:36:84
Signature algorithm name: SHA256withECDSA
Subject Public Key Algorithm: 521-bit EC (secp521r1) key
Version: 3


*******************************************
*******************************************</p>
      </div>
      <p class="section">
        Note that we used the recovered password in combination with keytool. This will be the end of our little tour. There are other
        options to consider and there are some rough edges as well. For example <a href="https://cr.yp.to/chacha/chacha-20080128.pdf">ChaCha20</a> 
        secret keys don't work since the underlying keystore implementation of the JDK doesn't recognize them.
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">2024-06-18-> Main menu

       (s)plit password       (m)erge password       (o)pen workspace
      (c)reate keystore        (lo)ad keystore       (li)st workspace
                 (e)xit

2024-06-18-> e
2024-06-18-> exit</p>
      </div>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="15" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">7.2 Keystore Engine</p>
      <p class="section">
        See section <a href="#13">6.2 Maven Coordinates</a> for the version of the present distribution. Subsequently, I give a simple example how to use the keystore engine within your 
        application. First, you need to install the provider:
      </p>
      <div class="code">
        <table style="border-collapse: separate; padding: 0.25em">
          <tr>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(01)</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(02)</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(03)</td>
                  </tr>
                </tbody>
              </table>
            </td>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">ShamirsProvider myProvider = new ShamirsProvider();</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">Security.addProvider(myProvider);</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">Stream.of(Security.getProviders()).forEach(provider -> System.out.printf("provider[%s] = %s\n", provider.getName(), provider.getInfo()));</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </table>
      </div>
      <p class="section">
        On my system I'm getting the following output:
      </p>
      <div class="code">
        <p class="code" style="white-space: pre">provider[SUN] = SUN (DSA key/parameter generation; DSA signing; SHA-1, MD5 digests; SecureRandom; X.509 certificates; PKCS12, JKS &amp; DKS keystores; PKIX CertPathValidator; PKIX CertPathBuilder; LDAP, Collection CertStores, JavaPolicy Policy; JavaLoginConfig Configuration)
provider[SunRsaSign] = Sun RSA signature provider
provider[SunEC] = Sun Elliptic Curve provider (EC, ECDSA, ECDH)
provider[SunJSSE] = Sun JSSE provider(PKCS12, SunX509/PKIX key/trust factories, SSLv3/TLSv1/TLSv1.1/TLSv1.2/TLSv1.3/DTLSv1.0/DTLSv1.2)
provider[SunJCE] = SunJCE Provider (implements RSA, DES, Triple DES, AES, Blowfish, ARCFOUR, RC2, PBE, Diffie-Hellman, HMAC, ChaCha20)
provider[SunJGSS] = Sun (Kerberos v5, SPNEGO)
provider[SunSASL] = Sun SASL provider(implements client mechanisms for: DIGEST-MD5, EXTERNAL, PLAIN, CRAM-MD5, NTLM; server mechanisms for: DIGEST-MD5, CRAM-MD5, NTLM)
provider[XMLDSig] = XMLDSig (DOM XMLSignatureFactory; DOM KeyInfoFactory; C14N 1.0, C14N 1.1, Exclusive C14N, Base64, Enveloped, XPath, XPath2, XSLT TransformServices)
provider[SunPCSC] = Sun PC/SC provider
provider[JdkLDAP] = JdkLDAP Provider (implements LDAP CertStore)
provider[JdkSASL] = JDK SASL provider(implements client and server mechanisms for GSSAPI)
provider[SunMSCAPI] = Sun's Microsoft Crypto API provider
provider[SunPKCS11] = Unconfigured and unusable PKCS11 provider
provider[Christofs Crypto Lib] = A pkcs12 KeyStore implementation which supports shared passwords.</p>
      </div>
      <p class="section">
        As can be seen the recently installed provider is the least significant one. The next statement requests the desired keystore engine: 
      </p>
      <div class="code">
        <table style="border-collapse: separate; padding: 0.25em">
          <tr>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(04)</td>
                  </tr>
                </tbody>
              </table>
            </td>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">KeyStore keyStore = KeyStore.getInstance("ShamirsKeystore", myProvider);</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </table>
      </div>
      <p class="section">
        In order to make it simple I'm building upon from the previous section <a href="#14">7.1 Demo App</a> by assuming the over there generated shares and keystore within a subdirectory
        <span class="code">test-workspace</span>.
      </p>
      <div class="code">
        <table style="border-collapse: separate; padding: 0.25em">
          <tr>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(05)</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(06)


  </td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(07)</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(08)</td>
                  </tr>
                </tbody>
              </table>
            </td>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">Path dir = Path.of(".", "test-workspace");</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">Set&lt;Path&gt; paths = Set.of(Path.of("demo-1.json"), Path.of("demo-3.json"), Path.of("demo-4.json"))
    .stream()
    .map(path -> dir.resolve(path))
    .collect(Collectors.toSet());</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">ShamirsProtection shamirsProtection = new ShamirsProtection(paths);</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">File keyStoreFile = dir.resolve("donalds-keys.p12").toFile();</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </table>
      </div>
      <p class="section">
        Now we have everything together to load the keystore:
      </p>
      <div class="code">
        <table style="border-collapse: separate; padding: 0.25em">
          <tr>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(09)</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">(10)</td>
                  </tr>
                </tbody>
              </table>
            </td>
            <td>
              <table>
                <tbody>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">ShamirsLoadParameter shamirsLoadParameter = new ShamirsLoadParameter(keyStoreFile, shamirsProtection);</td>
                  </tr>
                  <tr>
                    <td style="white-space: pre; font-family: monospace; font-size: 12px;">keyStore.load(shamirsLoadParameter);</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </table>
      </div>
      <p class="section">
        For further examples I am referring to the source code of the demo app.
      </p>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="16" class="headline-1">8. API Documentation</p>
      <table style="font-family: serif; width: 40%; margin-left: auto; margin-right: auto">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">APIs</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 50%">Module</th>
            <th class="cell" style="width: 50%">API Documentation</th>
          </tr>
          <tr style="">
            <td style="border-bottom-style: none; border-width: 1px; width: 50%; border-top-style: none; background-color: rgb(146,197,222)">shamirs-secret-sharing</td>
            <td style="border-bottom-style: none; border-width: 1px; width: 50%; border-top-style: none; background-color: rgb(146,197,222)">
              <a href="http://www.christofreichardt.de/project-studies/shamirs-lib/shamirs-secret-sharing/api/latest/scaladocs/de/christofreichardt/scala/shamir.html#">shamirs-secret-sharing 1.3.0 API</a>
            </td>
          </tr>
          <tr>
            <td style="border-bottom-style: none; border-bottom-width: 1px; width: 50%; background-color: rgb(146,197,222)">shamirs-keystore</td>
            <td style="border-bottom-style: none; border-bottom-width: 1px; width: 50%; background-color: rgb(146,197,222)">
              <a href="http://www.christofreichardt.de/project-studies/shamirs-lib/shamirs-keystore/api/latest/apidocs/index.html">shamirs-keystore 1.3.0 API</a>
            </td>
          </tr>
        </tbody>
      </table>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <p id="19" class="headline-1">9. JSON Schema</p>
      <p id="20" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">9.1 Definitions</p>
      <table style="font-family: serif; width: 60%; margin-left: auto; margin-right: auto">
        <caption style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">Partition</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 20%">Name</th>
            <th class="cell" style="width: 20%">Type</th>
            <th class="cell" style="width: 60%">Comment</th>
          </tr>
          <tr style="">
            <td class="cell">PartitionId</td>
            <td class="cell">string</td>
            <td class="cell">An Universally Unique Identifier</td>
          </tr>
          <tr style="">
            <td class="cell">Prime</td>
            <td class="cell">number</td>
            <td class="cell">Interpreted as BigInteger</td>
          </tr>
          <tr style="">
            <td class="cell">Threshold</td>
            <td class="cell">number</td>
            <td class="cell">Interpreted as 32-Bit Integer</td>
          </tr>
          <tr style="">
            <td class="cell">SharePoints</td>
            <td class="cell">array of <a href="#22">SharePoint</a></td>
            <td class="cell"></td>
          </tr>
        </tbody>
      </table>
      <table style="font-family: serif; width: 60%; margin-left: auto; margin-right: auto; margin-top: 1rem">
        <caption id="22" style="background-color: rgb(33,102,172); color: rgb(253,219,199); font-weight: bold">SharePoint</caption>
        <tbody style="text-align: center">
          <tr>
            <th class="cell" style="width: 20%">Name</th>
            <th class="cell" style="width: 20%">Type</th>
            <th class="cell" style="width: 60%">Comment</th>
          </tr>
          <tr style="">
            <td class="cell">x</td>
            <td class="cell">number</td>
            <td class="cell">Interpreted as BigInteger</td>
          </tr>
          <tr style="">
            <td class="cell">y</td>
            <td class="cell">number</td>
            <td class="cell">Interpreted as BigInteger</td>
          </tr>
        </tbody>
      </table>
      <p id="21" class="section" style="font-family: sans-serif; padding-left: 2rem; font-weight: bold">9.2 Example</p>
      <div class="code">
        <p class="code" style="white-space: pre">{
    "PartitionId": "242e3fda-9c64-45f3-b40d-52bdcf3db8ca",
    "Prime": 341494281274260103295293103126026736379588956778975874386655979,
    "Threshold": 4,
    "SharePoints": [
        {
            "SharePoint": {
                "x": 115100532256754722181886210957822661071917163545119627890196490,
                "y": 156627716112697373056443201494624435073664977495521717817469760
            }
        },
        {
            "SharePoint": {
                "x": 22609839444392691960191176427554135723838878004964001329002259,
                "y": 316594037802106556387665640965532931520415012810267565947034427
            }
        }
    ]
}</p>
      </div>
      <p class="section">
        <a href="#1">[ToC]</a>
      </p>
      <div id="imprint" style="text-align: center; border-top-style: solid; border-top-color: rgb(26,26,26); border-top-width: 1px; margin-top: 1rem">
        <img style="" src="./impressum.png" alt="Impressum" />
      </div>
    </div>
  </body>
</html>